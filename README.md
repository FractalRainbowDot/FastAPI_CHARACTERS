# –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π API –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π RPG-–∏–≥—Ä—ã, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

### –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ (`/characters`)

*   **`POST /`**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç JSON —Å –∏–º–µ–Ω–µ–º, —Å–∏–ª–æ–π, –ª–æ–≤–∫–æ—Å—Ç—å—é –∏ –∂–∏–≤—É—á–µ—Å—Ç—å—é.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –µ–≥–æ ID –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
*   **`GET /`**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.
*   **`GET /{character_id}`**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ –ø–æ –µ–≥–æ ID.
*   **`DELETE /`**: –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID.

### NPC (`/npcs`)

*   **`POST /`**: –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ NPC –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.
    *   –ï—Å–ª–∏ NPC –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ.
    *   –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ NPC —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏.

### –ë–∏—Ç–≤—ã (`/battle`)

*   **`POST /pvp`**: –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ PvP-–±–æ—è –º–µ–∂–¥—É –¥–≤—É–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏.
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç ID –∞—Ç–∞–∫—É—é—â–µ–≥–æ –∏ –∑–∞—â–∏—â–∞—é—â–µ–≥–æ—Å—è.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥ –±–æ—è.
*   **`POST /pve/{attacker_id}`**: –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ PvE-–±–æ—è –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –∏ NPC.
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç ID –∞—Ç–∞–∫—É—é—â–µ–≥–æ –∏ —É—Ä–æ–≤–µ–Ω—å NPC.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–≥ –±–æ—è.
*   **`POST /heal-all`**: –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.
*   **`POST /heal/{character_id}`**: –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –æ–¥–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (`src/app_v2`)

*   **`api/`**: –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å API.
    *   **`v1/`**: –í–µ—Ä—Å–∏—è 1 API.
        *   **`endpoints/`**: –§–∞–π–ª—ã —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ FastAPI (`characters.py`, `npcs.py`, `battle.py`).
        *   **`router.py`**: –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –∏–∑ `endpoints` –≤ –æ–¥–∏–Ω.
    *   **`dependencies.py`**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ä–≤–∏—Å—ã).
*   **`core/`**: –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
*   **`models/`**: Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –æ—Ç–≤–µ—Ç–∞—Ö.
*   **`services/`**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `character_service.py`, `npc_service.py`, `battle_service.py`).
*   **`db_models/`**: –ú–æ–¥–µ–ª–∏ SQLAlchemy –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
*   **`repositories/`**: –ö–ª–∞—Å—Å—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
*   **`main.py`**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ß–∏—Å—Ç–æ–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Clean Architecture) –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–ª–æ–∏:

```mermaid
graph TD
    Client([–ö–ª–∏–µ–Ω—Ç / HTTP –ó–∞–ø—Ä–æ—Å—ã HTTP])

    subgraph "–°–ª–æ–π API (api/v1/endpoints/)"
        RouterC[Characters Router<br>/characters]
        RouterB[Battle Router<br>/battle]
        RouterN[NPCs Router<br>/npcs]
    end

    subgraph "–°–ª–æ–π –í–∞–ª–∏–¥–∞—Ü–∏–∏ (models/)"
        PydanticC[–°—Ö–µ–º—ã –ò–≥—Ä–æ–∫–æ–≤<br>Pydantic]
        PydanticB[–°—Ö–µ–º—ã –ë–æ—è<br>Pydantic]
        PydanticN[–°—Ö–µ–º—ã NPC<br>Pydantic]
    end

    subgraph "–°–ª–æ–π –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (services/)"
        ServC[Character Service]
        ServB[Battle Service]
        ServN[NPC Service]
        ServE[Experience Service]
        Logger[Battle Logger]
    end

    subgraph "–°–ª–æ–π –î–∞–Ω–Ω—ã—Ö (repositories/)"
        RepoC[Character Repository]
        RepoN[NPC Repository]
    end

    subgraph "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (core/ & db_models/)"
        ModelC[Character DB Model<br>SQLAlchemy]
        ModelN[NPC DB Model<br>SQLAlchemy]
        DB[(SQLite –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)]
    end

    Client ==> RouterC
    Client ==> RouterB
    Client ==> RouterN

    RouterC -.->|–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç| PydanticC
    RouterB -.->|–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç| PydanticB
    RouterN -.->|–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç| PydanticN

    RouterC ===>|–í—ã–∑—ã–≤–∞–µ—Ç| ServC
    RouterB ===>|–í—ã–∑—ã–≤–∞–µ—Ç| ServB
    RouterN ===>|–í—ã–∑—ã–≤–∞–µ—Ç| ServN

    ServB -.->|–ù–∞—á–∏—Å–ª—è–µ—Ç –æ–ø—ã—Ç| ServE
    ServB -.->|–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏| Logger
    ServB -.->|–ü–æ–ª—É—á–∞–µ—Ç –∫—Ä–∏–ø–æ–≤| ServN

    ServC ===>|–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç| RepoC
    ServB ===>|–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç| RepoC
    ServB ===>|–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç| RepoN
    ServN ===>|–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç| RepoN

    RepoC -.->|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç| ModelC
    RepoN -.->|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç| ModelN

    RepoC ===>|SQL| DB
    RepoN ===>|SQL| DB

    classDef api fill:#e1f5fe,stroke:#03a9f4,stroke-width:2px;
    classDef service fill:#e8f5e9,stroke:#4caf50,stroke-width:2px;
    classDef repo fill:#fff3e0,stroke:#ff9800,stroke-width:2px;
    classDef db fill:#eceff1,stroke:#607d8b,stroke-width:2px;
    classDef model fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,stroke-dasharray: 5 5;

    class RouterC,RouterB,RouterN api;
    class ServC,ServB,ServN,ServE,Logger service;
    class RepoC,RepoN repo;
    class DB,ModelC,ModelN db;
    class PydanticC,PydanticB,PydanticN model;